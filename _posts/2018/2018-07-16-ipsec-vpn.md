---
layout: post
title: IpSecVPN
date: 2018-07-16 18:28:58
categories:
- 密码学与安全
tags:
---

IKE（ ISAKMP/Oakley/SKEME）：internet key exchange，internet 密钥交换协议，它是一个混合协议，并非为IPSec专用，只要其他协议需要，都可用它协商具体的安全服务。   
ISAKMP : Internet安全关联和密钥管理协议， 负责定义交换密钥和验证信息的载荷（信息的格式）  
SA：（Security Association，安全联盟）是两个IPSec实体（主机、安全网关）之间经过协商建立起来的一种协定，内容包括采用何种IPSec协议（AH还是ESP）、运行模式（传输模式还是隧道模式）、验证算法、加密算法、加密密钥、密钥生存期、抗重放窗口、计数器等，从而决定了保护什么、如何保护以及谁来保护。可以说SA是构成IPSec的基础。  
每个SA由三元组（SPI，IP目的地址，IPSec协议）来惟一标识 SPI（Security Parameter Index，安全参数索引）是32位的安全参数索引，用于标识具有相同IP地址和相同安全协议的不同的SA，它通常被放在AH或ESP头中 。 IP目的地址：IP目的地址，它是SA的终端地址。IPSec协议：采用AH或ESP。  
AH和ESP两个协议都使用SA来保护通信，而IKE的主要功能就是在通信双方协商SA。  
AH：Authentication Header，验证头部协议。HMAC（HMAC-MD5、HMAC-SHA1）  
ESP：Encapsulating Security Payload，封装安全载荷，RFC2406。ESP协议除了可以提供无连接的完整性、数据来源验证和抗重放攻击服务之外，还提供数据包和数据流加密服务。与AH相比，ESP验证的数据范围要小一些。不校验IP头，可以NAT透传    
Transport传输模式 Tunnel隧道模式  传输模式要保护的是IP包的载荷，通常情况下，只用于两台主机之间的安全通信。 隧道模式保护的是整个IP包。通常情况下，只要IPSec双方有一方是安全网关或路由器，就应该使用隧道模式。

提供抗回放攻击：通过在数据包中包括加密的序列号确保来自中间人攻击设备的抗回放攻击不能发生。  